# Kikyo (桔梗)

Windows用キーボード配列エミュレータ。Tauri v2 + Rustで実装されています。  
やまぶき互換配列定義ファイル (`.yab`) および `.bnz` 形式のサポートに加え、親指シフトや同時打鍵の詳細なカスタマイズが可能です。

## 機能

- **配列エミュレーション**:
  - `yab` (やまぶき互換) および `bnz` 形式の配列定義ファイルをサポート。
  - 親指シフト（単独打鍵時の動作、連続シフト、リピート設定など）の個別カスタマイズ。
  - 文字キー同士の同時打鍵判定（Chord）の微調整。
- **高度な設定GUI**:
  - タスクトレイおよび専用設定ウィンドウからのリアルタイム設定変更。
  - 設定の自動保存とプロファイル管理。
- **入力制御**:
  - IMEの状態（ローマ字/英数）を検知して配列セクションを自動切り替え。
  - 一時停止（Suspend）キーによるエミュレーションの即時ON/OFF切り替え。
- **安全性**:
  - 自己注入ガード。
  - 緊急停止機能 (`Ctrl` + `Alt` + `Esc`)。

## ⚠️ 緊急停止方法

万が一、設定ミスやバグで入力不能になった場合、以下の操作で強制終了できます：

**`Ctrl` + `Alt` + `Esc`**

アプリが即座に終了し、入力フックが解除されます。

## 実行方法

### 必要要件
- Rust (Cargo)
- Node.js (npm)
- Windows 10/11

### 開発モードで実行
```bash
cd crates/kikyo-ui-tauri
npm install
npm run tauri dev
```

### ビルド (リリース)
```bash
npm run tauri build
```
`src-tauri/target/release/kikyo-ui-tauri.exe` が生成されます。

## 使い方

1. アプリを起動するとタスクトレイにアイコン（桔梗のロゴ）が表示されます。
2. トレイアイコンを右クリック -> "Open Settings" または左クリックで設定画面を開きます。
3. **配列設定**:
   - "配列定義ファイル" の "参照..." ボタンから `.yab` または `.bnz` ファイルを選択し、"読み込み" を押します。
   - "文字キーのキーリピート" 設定で、文字割り当て有無に応じたリピート挙動を制御できます。
4. **親指シフト設定**:
   - 左右の親指キーを個別に設定可能（無変換、変換、Space、任意のキーなど）。
   - **単独打鍵**: 「無効」「有効（そのまま入力）」「前置シフト（次のキーにシフト適用）」「Spaceキー」から選択可能。
   - **連続シフト**: シフトキーを押したまま連続入力が可能かを設定。
   - **重なり割合**: 親指シフトと判定されるタイミングをスライダーで調整。
5. **文字キー同時打鍵設定**:
   - **連続シフト**: 同時打鍵の連続判定。
   - **重なり割合**: 文字キー同士が同時打鍵と判定されるタイミングを調整。
6. **動作モード設定**:
   - **一時停止キー**: エミュレータのON/OFFを切り替えるホットキー（ScrollLock, Pause, 右Shiftなど）を設定。
   - **IMEモード**: IME連動の挙動設定（Auto/TSF/IMM）。
7. **有効化**:
   - 画面上部のトグルスイッチ、またはタスクトレイメニューから "Enable Kikyo" をONにします。

## 構成

- `crates/kikyo-core`: 配列処理、フックのコアロジック (Rust Library)
- `crates/kikyo-ui-tauri`: GUIアプリ (Tauri v2 frontend + backend)

## 開発者 / 連絡先

不具合報告や要望は以下までお願いします。

- X (Twitter): [https://x.com/SurikireOfGokou](https://x.com/SurikireOfGokou)
- Email: [forestailjp@gmail.com](mailto:forestailjp@gmail.com)
